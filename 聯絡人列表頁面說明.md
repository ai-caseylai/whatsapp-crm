# 聯絡人列表頁面使用說明

## 📋 功能概述

全新的獨立聯絡人列表頁面，專門用於查看和管理所有 WhatsApp 聯絡人的信息。

## 🌐 訪問方式

**URL**：
```
https://whatsapp-crm.techforliving.app/contacts-list.html
```

或從主頁點擊「返回主頁」旁邊的鏈接訪問。

## ✨ 主要功能

### 1. 📊 統計概覽

**四個統計卡片**：
- **總聯絡人**：所有聯絡人總數
- **群組**：WhatsApp 群組數量
- **個人聯絡人**：個人對話數量
- **有名字**：已設置名字的聯絡人數

**實時更新**：載入聯絡人時自動計算統計

### 2. 🔍 搜索功能

**搜索框**：支持搜索以下字段
- 名字（name）
- 備註名稱（notify）
- 電話號碼
- JID（完整 WhatsApp ID）

**即時搜索**：輸入時自動過濾結果

### 3. 🎯 篩選功能

**類型篩選**：
- **全部**：顯示所有聯絡人
- **群組**：只顯示 @g.us 群組
- **個人**：只顯示個人聯絡人
- **LID 聯絡人**：只顯示 @lid 類型聯絡人

### 4. 📈 排序功能

**四種排序方式**：
- **名字 (A-Z)**：按名字字母順序升序
- **名字 (Z-A)**：按名字字母順序降序
- **最近更新**：按最後更新時間降序（預設）
- **電話號碼**：按電話號碼數字順序

### 5. 📄 數據表格

**表格列**：
1. **#**：序號
2. **類型**：群組/個人/LID（彩色標籤）
3. **名字**：聯絡人顯示名稱
4. **電話號碼**：格式化的電話號碼
5. **備註名稱**：WhatsApp 備註名
6. **JID**：完整的 WhatsApp ID
7. **最後更新**：最後更新時間

**特色**：
- ✅ 懸停高亮行
- ✅ 彩色類型標籤
- ✅ 等寬字體顯示電話和 JID
- ✅ 自動截斷過長內容

### 6. 📑 分頁功能

**每頁顯示**：50 個聯絡人

**分頁控制**：
- 上一頁/下一頁按鈕
- 顯示當前範圍（如：顯示 1-50 / 共 1000 個）
- 切換頁面時自動滾動到頂部

### 7. 📥 匯出 CSV

**功能**：
- 一鍵匯出當前篩選結果
- UTF-8 編碼（支持中文）
- Excel 兼容格式
- 包含所有欄位數據

**文件名格式**：
```
聯絡人列表_2026-02-05.csv
```

**CSV 內容**：
```csv
編號,類型,名字,電話號碼,備註名稱,JID,最後更新
1,"群組","AiTLE 20/11 SolnShow PRT","+852 1234 5678","(無)","120363019503865721@g.us","2026-02-05 12:30"
```

## 🎨 界面特點

### 響應式設計

**桌面版**：
- 四列統計卡片
- 完整表格顯示所有欄位
- 寬敞的間距

**移動版**：
- 統計卡片自動堆疊
- 表格可橫向滾動
- 優化觸摸操作

### 顏色標籤

**聯絡人類型**：
- **群組**：紫色標籤
- **個人**：綠色標籤
- **LID**：藍色標籤

### 視覺反饋

- 按鈕懸停效果
- 行懸停高亮
- 禁用按鈕變灰
- 載入動畫

## 📱 使用場景

### 場景 1：查找特定聯絡人

1. 在搜索框輸入名字或電話
2. 即時看到篩選結果
3. 點擊查看完整信息

### 場景 2：統計分析

1. 查看統計卡片
2. 了解聯絡人分布
3. 評估數據完整性

### 場景 3：批量導出

1. 設置需要的篩選條件
2. 點擊「匯出 CSV」按鈕
3. 在 Excel 中進一步處理

### 場景 4：審核數據質量

1. 篩選「個人」聯絡人
2. 排序按「名字」
3. 檢查哪些聯絡人沒有名字

## 🔧 技術細節

### API 調用

**端點**：`GET /api/session/:id/contacts`

**數據字段**：
```javascript
{
  jid: "85212345678@s.whatsapp.net",
  name: "張三",
  notify: "Zhang San",
  is_group: false,
  last_message_time: "2026-02-05T12:30:00Z",
  updated_at: "2026-02-05T12:30:00Z",
  session_id: "sess_xxx"
}
```

### 前端邏輯

**排序實現**：
```javascript
filteredContacts.sort((a, b) => {
    switch (sortFilter) {
        case 'name':
            return (a.name || a.jid).localeCompare(b.name || b.jid);
        case 'updated':
            return (b.updated_at || '').localeCompare(a.updated_at || '');
        // ...
    }
});
```

**篩選實現**：
```javascript
filteredContacts = allContacts.filter(contact => {
    // 類型篩選
    if (typeFilter === 'groups' && !contact.jid?.endsWith('@g.us')) 
        return false;
    
    // 搜索篩選
    if (searchQuery) {
        return name.includes(searchQuery) || 
               phone.includes(searchQuery);
    }
    
    return true;
});
```

### 性能優化

**本地篩選**：
- 一次性載入所有聯絡人
- 前端進行篩選和排序
- 避免頻繁 API 調用

**分頁渲染**：
- 每頁只渲染 50 個聯絡人
- 避免 DOM 過大影響性能

**懶加載**：
- 統計信息按需計算
- CSV 匯出時才生成文件

## 📈 數據統計示例

**典型數據**：
```
總聯絡人：1000
群組：642
個人聯絡人：358
有名字：639
```

**分析**：
- 64.2% 是群組
- 35.8% 是個人聯絡人
- 63.9% 的聯絡人有設置名字

## 🎯 最佳實踐

### 1. 定期審核

**建議頻率**：每週一次

**檢查項目**：
- 無名字的聯絡人數量
- 新增的 LID 聯絡人
- 群組名稱更新情況

### 2. 數據備份

**操作**：
1. 匯出完整的 CSV
2. 保存到本地或雲端
3. 設置文件名包含日期

**用途**：
- 歷史記錄
- 數據恢復
- 外部分析

### 3. 批量操作

**通過 CSV**：
1. 匯出當前數據
2. 在 Excel 中編輯
3. 批量更新（未來功能）

### 4. 搜索技巧

**精確搜索**：
- 輸入完整電話號碼
- 輸入 JID 的一部分

**模糊搜索**：
- 輸入名字的部分字符
- 中英文都支持

## ⚠️ 注意事項

### 1. 數據實時性

**注意**：
- 頁面載入時獲取數據
- 不會自動刷新
- 需要手動點擊「重新載入」

### 2. 大量數據

**當聯絡人超過 5000 時**：
- 載入可能需要 5-10 秒
- 搜索和排序仍然很快
- 考慮增加分頁大小

### 3. CSV 編碼

**Excel 打開**：
- 文件使用 UTF-8 BOM
- 自動識別中文
- 如果亂碼，使用「數據」→「從文本」導入

### 4. 隱私保護

**建議**：
- 不要分享 CSV 文件
- 包含所有聯絡人電話號碼
- 注意數據安全

## 🚀 未來功能規劃

### 即將推出

1. **批量編輯**
   - 批量修改聯絡人名稱
   - 批量添加標籤
   - 批量刪除

2. **高級篩選**
   - 按創建時間範圍
   - 按最後消息時間
   - 多條件組合

3. **數據分析**
   - 聯絡人增長趨勢圖
   - 活躍度分析
   - 群組參與度

4. **標籤系統**
   - 自定義標籤
   - 顏色分類
   - 標籤搜索

## 💡 常見問題

### Q1：為什麼有些聯絡人沒有名字？

**答**：
- LID 聯絡人默認沒有名字
- 未保存在通訊錄的聯絡人
- 點擊主頁的「聯絡人」按鈕嘗試刷新

### Q2：如何查看某個群組的成員？

**答**：
- 當前頁面只顯示聯絡人列表
- 群組成員需要在主界面查看
- 點擊群組進入對話查看

### Q3：CSV 匯出後 Excel 顯示亂碼？

**答**：
1. 打開 Excel
2. 選擇「數據」→「從文本」
3. 選擇 CSV 文件
4. 編碼選擇「UTF-8」
5. 完成導入

### Q4：能否直接編輯聯絡人信息？

**答**：
- 當前版本只支持查看
- 編輯功能正在開發中
- 可以先匯出 CSV 編輯

### Q5：頁面載入很慢怎麼辦？

**答**：
1. 檢查網絡連接
2. 清除瀏覽器緩存
3. 重新載入頁面
4. 如果持續緩慢，聯系管理員

## 📚 相關文檔

- `群組名稱修復說明.md` - 群組名稱顯示問題
- `LID聯絡人顯示修復說明.md` - LID 聯絡人處理
- `自動重連和同步說明.md` - 數據同步機制

## 🎉 總結

### 核心價值

✅ **統一管理**：一個頁面查看所有聯絡人  
✅ **強大搜索**：快速找到需要的聯絡人  
✅ **靈活篩選**：多維度查看數據  
✅ **便捷匯出**：數據備份和分析  
✅ **美觀界面**：現代化設計和響應式布局  

### 使用建議

1. **日常查看**：快速查找聯絡人信息
2. **定期審核**：檢查數據完整性
3. **備份數據**：定期匯出 CSV
4. **搭配主頁**：主頁查看消息，此頁管理聯絡人

**聯絡人列表頁面現已上線，立即訪問體驗！** 🎊

---

**訪問地址**：https://whatsapp-crm.techforliving.app/contacts-list.html

**更新日期**：2026-02-05
