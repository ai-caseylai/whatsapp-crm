# AI 助手使用指南

## 🤖 Gemini 3 AI 助手

本系統使用 **Open Router** 提供的免費 AI 模型（Pony Alpha）來實現智能助手功能。

---

## ⚠️ 常見錯誤與解決方案

### 1. **429 錯誤：請求頻率限制**

**錯誤訊息**：
```
錯誤: Open Router API 返回錯誤: 429
⏰ API 請求頻率限制

免費模型每分鐘有請求次數限制。請稍後再試（建議等待 1-2 分鐘）。
```

**原因**：
- 免費模型有每分鐘請求次數限制（通常為 10-20 次/分鐘）
- 短時間內發送太多請求

**解決方案**：
1. ⏱️ **等待 1-2 分鐘**後再試
2. 📉 **減少請求頻率**：避免連續快速發送多條消息
3. 📝 **合併請求**：將多個問題合併成一條消息發送
4. 🕐 **錯峰使用**：避開高峰時段使用

---

### 2. **401 錯誤：API 認證失敗**

**原因**：
- API Key 無效或已過期
- 環境變量未正確加載

**解決方案**：
1. 檢查 `.env` 文件中的 `GEMINI_API_KEY`
2. 確認 API Key 是否正確
3. 重啟服務器：`node server.js`

---

### 3. **404 錯誤：模型不可用**

**原因**：
- 使用的模型已下線或不存在
- 模型名稱錯誤

**解決方案**：
1. 檢查 `server.js` 中的模型名稱
2. 當前使用：`openrouter/pony-alpha`
3. 訪問 [Open Router Models](https://openrouter.ai/models) 查看可用模型

---

## 💡 使用建議

### 對話功能
- ✅ **適合**：一般問答、諮詢、信息查詢
- ⏰ **頻率建議**：每條消息間隔 5-10 秒
- 📝 **消息長度**：建議每條消息不超過 500 字

### 聊天分析功能
- ✅ **適合**：分析 10-50 條消息的對話
- ⏰ **頻率建議**：每次分析間隔 10-15 秒
- 📊 **消息數量**：建議每次分析不超過 100 條消息

---

## 🔄 替代方案

如果頻繁遇到 429 錯誤，可以考慮：

### 方案 1：使用付費 API
在 `.env` 文件中設置其他 API：
```env
# Google AI Studio（免費但有配額）
GEMINI_API_KEY=your-google-ai-studio-key

# OpenAI（付費）
OPENAI_API_KEY=your-openai-key
```

### 方案 2：降低使用頻率
- 設置請求間隔時間（前端節流）
- 合併多個小請求為一個大請求
- 使用緩存減少重複請求

### 方案 3：本地部署開源模型
- 使用 Ollama 部署本地 LLM
- 無頻率限制，但需要硬件資源

---

## 📊 Open Router 免費模型限制

| 項目 | 限制 |
|------|------|
| 每分鐘請求數 | 10-20 次 |
| 每小時請求數 | 100-200 次 |
| 每天請求數 | 1000-2000 次 |
| 最大 Token 數 | 2048 tokens |
| 並發請求 | 1-3 個 |

**注意**：具體限制可能隨時變動，請參考 [Open Router 官方文檔](https://openrouter.ai/docs#rate-limits)。

---

## 🛠️ 技術支持

如有問題，請檢查：
1. 📋 服務器日誌：`tail -f server.log`
2. 🌐 瀏覽器控制台（F12）
3. 📡 網絡請求狀態

---

**最後更新**：2026-02-08
