# WhatsApp CRM è‡ªåŠ¨éƒ¨ç½²ä½¿ç”¨è¯´æ˜

## âœ… å·²å®Œæˆçš„é…ç½®

### 1. GitHub ä»“åº“å·²è®¾ç½®
- ä»“åº“åœ°å€ï¼šhttps://github.com/ai-caseylai/whatsapp-crm
- æœåŠ¡å™¨å·²è¿æ¥åˆ° GitHub
- è‡ªåŠ¨éƒ¨ç½²è„šæœ¬å·²é…ç½®

### 2. æœåŠ¡å™¨ç«¯é…ç½®
- Git ä»“åº“ï¼šâœ… å·²åˆå§‹åŒ–
- è¿œç¨‹ä»“åº“ï¼šâœ… å·²è¿æ¥
- éƒ¨ç½²è„šæœ¬ï¼šâœ… å·²å®‰è£… (`deploy.sh`)
- Webhook æœåŠ¡ï¼šâœ… å·²å°±ç»ª (`webhook-server.js`)
- å¿«æ·å‘½ä»¤ï¼šâœ… å·²é…ç½®

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1ï¼šæœ¬åœ°æ¨é€åæ‰‹åŠ¨éƒ¨ç½²ï¼ˆæœ€ç®€å•ï¼‰

#### æ­¥éª¤ï¼š
1. **æœ¬åœ°ä¿®æ”¹ä»£ç å¹¶æ¨é€åˆ° GitHub**
   ```bash
   cd /Users/apple/Desktop/development/whatsapp-crm
   # ä¿®æ”¹ä»£ç ...
   git add .
   git commit -m "ä½ çš„æäº¤ä¿¡æ¯"
   git push origin main
   ```

2. **SSH åˆ°æœåŠ¡å™¨å¹¶éƒ¨ç½²**
   ```bash
   ssh whatsapp-crm
   deploy-crm
   ```

å°±è¿™ä¹ˆç®€å•ï¼âœ¨

---

### æ–¹æ³• 2ï¼šå®Œå…¨è‡ªåŠ¨éƒ¨ç½²ï¼ˆæ¨è - éœ€è¦é…ç½® Webhookï¼‰

#### ä¸€æ¬¡æ€§é…ç½®ï¼ˆ10åˆ†é’Ÿï¼‰ï¼š

1. **å¯åŠ¨ Webhook æœåŠ¡å™¨**
   ```bash
   ssh whatsapp-crm
   cd /home/ubuntu/whatsapp-bot
   pm2 start webhook-server.js --name whatsapp-webhook
   pm2 save
   ```

2. **é…ç½® GitHub Webhook**
   - æ‰“å¼€ï¼šhttps://github.com/ai-caseylai/whatsapp-crm/settings/hooks
   - ç‚¹å‡»ã€ŒAdd webhookã€
   - é…ç½®ï¼š
     ```
     Payload URL: http://whatsapp-crm.techforliving.app:9000/webhook/deploy
     Content type: application/json
     Secret: ç•™ç©ºæˆ–è®¾ç½®ä¸€ä¸ªå¯†é’¥
     Events: Just the push event
     Active: âœ…
     ```
   - ç‚¹å‡»ã€ŒAdd webhookã€

3. **æµ‹è¯•**
   æ¨é€ä»£ç åˆ° GitHubï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨éƒ¨ç½²ï¼

#### ä»¥åçš„ä½¿ç”¨ï¼š
```bash
# æœ¬åœ°
cd /Users/apple/Desktop/development/whatsapp-crm
# ä¿®æ”¹ä»£ç ...
git add .
git commit -m "ä¿®å¤æŸä¸ªé—®é¢˜"
git push origin main

# ğŸ‰ è‡ªåŠ¨éƒ¨ç½²ï¼æ— éœ€ä»»ä½•æ“ä½œï¼
```

---

### æ–¹æ³• 3ï¼šå®šæ—¶è‡ªåŠ¨éƒ¨ç½²

æœåŠ¡å™¨æ¯å°æ—¶è‡ªåŠ¨æ£€æŸ¥æ›´æ–°å¹¶éƒ¨ç½²ï¼š

```bash
ssh whatsapp-crm
crontab -e

# æ·»åŠ è¿™ä¸€è¡Œï¼ˆæ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡ï¼‰
0 * * * * /home/ubuntu/whatsapp-bot/deploy.sh >> /home/ubuntu/whatsapp-bot/deploy.log 2>&1
```

---

## ğŸ¯ å¿«æ·å‘½ä»¤

SSH åˆ°æœåŠ¡å™¨åå¯ä»¥ä½¿ç”¨ï¼š

```bash
deploy-crm      # æ‰‹åŠ¨éƒ¨ç½²
crm-logs        # æŸ¥çœ‹æœåŠ¡æ—¥å¿—
crm-status      # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
crm-restart     # é‡å¯æœåŠ¡
```

---

## ğŸ“Š æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€

### æŸ¥çœ‹æœ€æ–°éƒ¨ç½²
```bash
ssh whatsapp-crm
cd /home/ubuntu/whatsapp-bot
git log -5 --oneline
```

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
ssh whatsapp-crm
pm2 status
```

### æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
```bash
ssh whatsapp-crm
tail -f /home/ubuntu/whatsapp-bot/deploy.log  # å¦‚æœé…ç½®äº†å®šæ—¶ä»»åŠ¡
pm2 logs whatsapp-bot                         # æŸ¥çœ‹æœåŠ¡æ—¥å¿—
pm2 logs whatsapp-webhook                     # æŸ¥çœ‹ Webhook æ—¥å¿—ï¼ˆå¦‚æœå¯ç”¨ï¼‰
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ï¼Ÿ
```bash
ssh whatsapp-crm
cd /home/ubuntu/whatsapp-bot
git log --oneline                    # æŸ¥çœ‹å†å²ç‰ˆæœ¬
git reset --hard <commit-hash>       # å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
pm2 restart whatsapp-bot
```

### Q: å¦‚ä½•æš‚åœè‡ªåŠ¨éƒ¨ç½²ï¼Ÿ
```bash
ssh whatsapp-crm
pm2 stop whatsapp-webhook            # åœæ­¢ Webhook æœåŠ¡
# æˆ–è€…åœ¨ GitHub ç¦ç”¨ Webhook
```

### Q: å¦‚ä½•éªŒè¯æ˜¯å¦éƒ¨ç½²æˆåŠŸï¼Ÿ
```bash
ssh whatsapp-crm
cd /home/ubuntu/whatsapp-bot
git log -1                           # æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
pm2 status whatsapp-bot              # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
curl https://whatsapp-crm.techforliving.app  # æµ‹è¯•ç½‘ç«™
```

---

## ğŸ“ å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹

### åœºæ™¯ï¼šä¿®å¤ä¸€ä¸ª bug

1. **æœ¬åœ°ä¿®æ”¹ä»£ç **
   ```bash
   cd /Users/apple/Desktop/development/whatsapp-crm
   # ç¼–è¾‘ server.js ä¿®å¤ bug
   ```

2. **æµ‹è¯•ï¼ˆå¯é€‰ï¼‰**
   ```bash
   npm install
   node server.js
   # æµ‹è¯•åŠŸèƒ½...
   ```

3. **æäº¤å¹¶æ¨é€**
   ```bash
   git add server.js
   git commit -m "fix: ä¿®å¤æ¶ˆæ¯æ¥æ”¶é—®é¢˜"
   git push origin main
   ```

4. **éƒ¨ç½²åˆ°æœåŠ¡å™¨**
   
   **æ–¹å¼ A - æ‰‹åŠ¨éƒ¨ç½²ï¼š**
   ```bash
   ssh whatsapp-crm
   deploy-crm
   ```
   
   **æ–¹å¼ B - è‡ªåŠ¨éƒ¨ç½²ï¼ˆå¦‚å·²é…ç½® Webhookï¼‰ï¼š**
   - æ— éœ€ä»»ä½•æ“ä½œï¼Œæ¨é€åè‡ªåŠ¨éƒ¨ç½²ï¼
   
   **æ–¹å¼ C - ç­‰å¾…å®šæ—¶éƒ¨ç½²ï¼ˆå¦‚å·²é…ç½® cronï¼‰ï¼š**
   - ç­‰å¾…ä¸‹ä¸€ä¸ªæ•´ç‚¹è‡ªåŠ¨éƒ¨ç½²

5. **éªŒè¯**
   ```bash
   ssh whatsapp-crm
   crm-logs
   # æŸ¥çœ‹æ—¥å¿—ç¡®è®¤ä¿®å¤ç”Ÿæ•ˆ
   ```

---

## ğŸ‰ æ¨èé…ç½®

**æ–°æ‰‹æ¨è**ï¼šæ–¹æ³• 1ï¼ˆæ‰‹åŠ¨éƒ¨ç½²ï¼‰- ç®€å•å¯æ§

**ç†Ÿç»ƒåæ¨è**ï¼šæ–¹æ³• 2ï¼ˆWebhook è‡ªåŠ¨éƒ¨ç½²ï¼‰- å®Œå…¨è‡ªåŠ¨åŒ–

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- è¯¦ç»†æŠ€æœ¯æ–‡æ¡£ï¼š`DEPLOY.md`
- æ›´æ–°æ—¥å¿—ï¼š`CHANGELOG.md`
- é¡¹ç›®è¯´æ˜ï¼š`README.md`

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼š
```bash
ssh whatsapp-crm
pm2 logs whatsapp-bot --lines 100
```

æŸ¥çœ‹ Git çŠ¶æ€ï¼š
```bash
ssh whatsapp-crm
cd /home/ubuntu/whatsapp-bot
git status
git log -5 --oneline
```

---

**é…ç½®å®Œæˆï¼** ğŸŠ

ä»ç°åœ¨å¼€å§‹ï¼Œä½ åªéœ€è¦ï¼š
1. åœ¨æœ¬åœ°ä¿®æ”¹ä»£ç 
2. æ¨é€åˆ° GitHub
3. SSH åˆ°æœåŠ¡å™¨è¿è¡Œ `deploy-crm`ï¼ˆæˆ–è‡ªåŠ¨éƒ¨ç½²ï¼‰

å°±è¿™ä¹ˆç®€å•ï¼âœ¨
