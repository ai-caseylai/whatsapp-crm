# ✨ Nano Banana Pro - AI 圖片編輯與生成

> 使用 OpenRouter 的 `google/gemini-3-pro-image-preview` 模型，為 WhatsApp CRM 添加強大的圖片處理能力

## 🎯 核心功能

### 1. 圖片分析 🔍
- 分析圖片內容
- 提取圖片文字（OCR）
- 識別人物、物體、場景
- 分析顏色主題和構圖

### 2. 圖片編輯 🎨
- **移除背景**：自動去除圖片背景
- **調整亮度**：提高或降低圖片亮度
- **增強對比度**：讓圖片更清晰
- **添加效果**：模糊、銳化、濾鏡等
- **風格轉換**：轉換為黑白、復古、水彩等風格

### 3. 圖片生成 🖼️
- 從文字描述生成圖片
- 支持高分辨率（最高 4K）
- 自定義寬高比
- 多語種支持（繁體中文、簡體中文、英文等）

## 🚀 快速開始

### 1. 使用圖片編輯

```
1. 在 WhatsApp 聊天中選擇一張圖片
2. 點擊「圖片分析」按鈕
3. 在 Gemini 側邊欄中選擇編輯選項：
   - 🎨 移除背景
   - ☀️ 提高亮度
   - 🔆 增強對比度
   - 🌫️ 模糊效果
   - ✨ 銳化圖片
4. 或輸入自定義命令，如「把這張圖轉換成黑白」
5. 等待 AI 處理並返回新圖片
6. 點擊「📤 發送到 WhatsApp」發送編輯後的圖片
```

### 2. 編輯指令示例

**簡單編輯：**
- `移除背景`
- `提高亮度`
- `增強對比度`
- `裁剪成正方形`

**進階編輯：**
- `添加 30% 的亮度並稍微增強對比度`
- `移除背景並添加柔和陰影`
- `轉換成黑白風格並提高銳度`

**創意編輯：**
- `把這張照片轉換成復古濾鏡效果`
- `將圖片轉換為水彩畫風格`
- `添加淺色邊框和漸變背景`

## 🔧 配置要求

### API Key 配置
在 `.env` 文件中配置 OpenRouter API Key：

```env
GEMINI_API_KEY=your-openrouter-api-key
```

獲取 API Key：[OpenRouter Dashboard](https://openrouter.ai/keys)

### 模型說明
- **模型名稱**：`google/gemini-3-pro-image-preview`
- **別名**：Nano Banana Pro
- **功能**：圖片生成、編輯、分析
- **輸出**：支持多模態（圖片 + 文字）

## 💰 成本說明

根據 OpenRouter 計費：
- **輸入**：$2/M tokens
- **輸出**：$12/M tokens

**注意**：圖片編輯會產生較高的輸出成本（返回 base64 圖片）

建議：
- ✅ 分析功能成本低，可頻繁使用
- ⚠️ 編輯功能成本較高，按需使用
- 💰 定期檢查 OpenRouter 餘額

## 📊 功能對比

| 功能 | 支持情況 |
|------|---------|
| 圖片分析 | ✅ |
| 文字提取 (OCR) | ✅ |
| 移除背景 | ✅ |
| 調整亮度/對比度 | ✅ |
| 添加濾鏡效果 | ✅ |
| 風格轉換 | ✅ |
| 多圖像融合 | ✅ |
| 高分辨率輸出 | ✅ (2K/4K) |
| 多模態輸出 | ✅ (圖+文) |

## 🎨 UI 截圖說明

### 圖片選擇界面
- 點擊 WhatsApp 消息中的圖片
- 顯示快捷編輯按鈕
- 提示「Nano Banana Pro 支持圖片編輯」

### 編輯處理中
- 顯示「🎨 處理中...」動畫
- 模型標籤：「AI 編輯 (Nano Banana Pro)」

### 編輯完成
- 顯示編輯後的圖片
- 三個操作按鈕：
  - 📤 發送到 WhatsApp
  - 🔍 查看大圖
  - 💾 下載

## 🐛 常見問題

### Q1: 編輯後只返回文字沒有圖片？
**A**: 嘗試使用更明確的編輯指令，例如：
- ❌ 「處理這張圖」
- ✅ 「移除背景並生成新圖片」

### Q2: API 返回 429 錯誤？
**A**: 請求頻率過高，等待 1-2 分鐘後再試。

### Q3: API 返回 402 錯誤？
**A**: OpenRouter 餘額不足，請前往 [OpenRouter Credits](https://openrouter.ai/credits) 充值。

### Q4: 編輯時間很長？
**A**: 複雜編輯（如移除背景、風格轉換）可能需要 20-40 秒，屬於正常範圍。

## 📚 相關文檔

- [完整升級文檔](./NANO_BANANA_PRO_UPGRADE.md) - 詳細技術實現
- [測試指南](./NANO_BANANA_PRO_TESTING.md) - 功能測試步驟
- [OpenRouter 文檔](https://openrouter.ai/docs) - API 參考

## 🎉 更新亮點

### v0.9.0 - Nano Banana Pro 升級
- ✨ 新增圖片編輯功能（移除背景、調整亮度、濾鏡等）
- ✨ 支持多模態輸出（圖片 + 文字）
- ✨ 快捷編輯按鈕（7 種預定義效果）
- ✨ 自動保存編輯後的圖片
- ✨ 一鍵發送到 WhatsApp
- 🔧 後端添加 `modalities` 參數支持
- 🔧 增強響應解析邏輯（支持多種返回格式）
- 📝 完整的技術文檔和測試指南

## 🚀 下一步計劃

- [ ] 批量處理多張圖片
- [ ] 編輯歷史記錄
- [ ] 編輯模板保存與復用
- [ ] 預覽功能
- [ ] 高級參數自定義（分辨率、壓縮率等）

---

**Made with ❤️ using OpenRouter & Nano Banana Pro**
