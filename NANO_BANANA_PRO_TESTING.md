# 🧪 Nano Banana Pro 功能測試指南

## 快速測試步驟

### 1. 啟動服務器
```bash
cd /Users/apple/CodeBuddy/20260207234741/whatsapp-crm
npm start
```

### 2. 登入 WhatsApp
- 打開瀏覽器訪問 `http://localhost:3000`
- 掃描 QR 碼登入 WhatsApp

### 3. 測試圖片分析功能 ✅

#### 測試步驟：
1. 選擇任意聊天
2. 點擊消息中的圖片
3. 點擊「圖片分析」按鈕
4. 圖片會顯示在 Gemini 側邊欄
5. 點擊「🔍 分析圖片」按鈕
6. 等待 AI 返回分析結果

#### 預期結果：
- ✅ 圖片正確顯示
- ✅ AI 返回圖片內容描述
- ✅ 模型標籤顯示「AI 編輯 (Nano Banana Pro)」

#### 測試指令示例：
```
請分析這張圖片的內容
請提取圖片中的文字
描述這張圖片的顏色主題
```

---

### 4. 測試圖片編輯功能 🎨

#### 測試步驟：
1. 在 Gemini 側邊欄中已有圖片的情況下
2. 點擊編輯按鈕（如「🎨 移除背景」）
3. 修改命令（可選）
4. 按 Enter 發送
5. 等待 AI 返回編輯後的圖片

#### 預期結果：
- ✅ 顯示「🎨 處理中...」
- ✅ 返回編輯後的新圖片
- ✅ 圖片下方顯示三個按鈕：
  - 📤 發送到 WhatsApp
  - 🔍 查看大圖
  - 💾 下載

#### 測試指令示例：

**簡單編輯：**
```
移除背景
提高亮度
增強對比度
添加模糊效果
銳化圖片
```

**進階編輯：**
```
把這張圖片轉換成黑白風格
添加 20% 的亮度並增強對比度
裁剪成正方形並添加柔和陰影
把背景改成漸變藍色
```

**創意編輯：**
```
給這張照片添加復古濾鏡效果
將圖片轉換為水彩畫風格
添加淺色邊框和陰影效果
```

---

### 5. 測試發送功能 📤

#### 測試步驟：
1. 編輯完成後，點擊「📤 發送到 WhatsApp」
2. 等待上傳完成
3. 檢查 WhatsApp 聊天中是否收到圖片

#### 預期結果：
- ✅ 顯示「📤 正在發送圖片...」
- ✅ 顯示「✅ 圖片已發送！」
- ✅ WhatsApp 聊天中收到編輯後的圖片
- ✅ 圖片帶有標題「✨ AI 編輯完成」

---

## 🔍 調試檢查

### 前端檢查
打開瀏覽器開發者工具（F12），觀察：

1. **Network 標籤**
   - 查看 `/api/llm/edit-image` 請求
   - 確認請求參數包含：`imagePath`, `instruction`, `history`
   - 確認響應包含：`processedImagePath`, `processedImageUrl`

2. **Console 標籤**
   - 查看是否有錯誤信息
   - 確認模型標籤正確顯示

### 後端檢查
查看終端輸出：

```bash
# 正常流程
🎨 調用 Gemini 3 Pro Image Preview 進行圖片編輯/生成...
📝 編輯指令: 移除背景
📦 Gemini 響應: { ... }
📝 返回內容類型: string  # 或 object
✅ 圖片編輯完成，保存至: edited_1707398765432.png
```

### 常見問題

#### 問題 1：返回純文字而非圖片
**原因**：模型理解為分析而非編輯
**解決**：
- 使用更明確的編輯指令
- 嘗試快捷按鈕中的預定義命令
- 在指令中強調「生成新圖片」

#### 問題 2：API 錯誤 429
**原因**：請求頻率過高
**解決**：
- 等待 1-2 分鐘再試
- 減少測試頻率

#### 問題 3：API 錯誤 402
**原因**：OpenRouter 餘額不足
**解決**：
- 前往 [OpenRouter](https://openrouter.ai/credits) 充值
- 檢查帳戶餘額

#### 問題 4：圖片無法保存
**原因**：權限問題或路徑錯誤
**解決**：
```bash
# 檢查 media 目錄權限
ls -la ./media/

# 如果不存在，創建目錄
mkdir -p ./media/
chmod 755 ./media/
```

---

## 📊 測試清單

### 功能測試
- [ ] 圖片分析功能正常
- [ ] 圖片編輯功能正常
- [ ] 文字提取功能正常
- [ ] 移除背景功能正常
- [ ] 亮度調整功能正常
- [ ] 對比度調整功能正常
- [ ] 模糊效果功能正常
- [ ] 銳化功能正常
- [ ] 自定義指令功能正常

### UI 測試
- [ ] 快捷按鈕正確顯示
- [ ] 模型標籤正確顯示
- [ ] 提示信息正確
- [ ] 編輯後圖片正確顯示
- [ ] 操作按鈕（發送/查看/下載）正常工作

### 整合測試
- [ ] 發送到 WhatsApp 功能正常
- [ ] 下載圖片功能正常
- [ ] 查看大圖功能正常
- [ ] 多次編輯同一張圖片
- [ ] 切換不同圖片編輯

---

## 🎯 性能基準

### 響應時間（參考）
- **圖片分析**：3-8 秒
- **簡單編輯**：10-20 秒（如調整亮度）
- **複雜編輯**：20-40 秒（如移除背景）
- **創意編輯**：30-60 秒（如風格轉換）

### 圖片大小
- **輸入**：建議 < 5MB
- **輸出**：通常 500KB - 2MB（PNG 格式）

---

## 📝 測試報告模板

```
測試日期: ________
測試人員: ________

## 分析功能
✅/❌ 基本分析
✅/❌ 文字提取
問題描述: ________

## 編輯功能
✅/❌ 移除背景
✅/❌ 亮度調整
✅/❌ 對比度
✅/❌ 模糊效果
✅/❌ 銳化
✅/❌ 自定義指令
問題描述: ________

## 發送功能
✅/❌ 發送到 WhatsApp
✅/❌ 下載圖片
✅/❌ 查看大圖
問題描述: ________

## 性能
平均響應時間: ______ 秒
是否有卡頓: ✅/❌

## 總體評價
整體滿意度: ⭐⭐⭐⭐⭐
改進建議: ________
```

---

## 🎉 成功標準

測試通過條件：
1. ✅ 所有功能測試項目通過
2. ✅ 無嚴重錯誤或崩潰
3. ✅ 響應時間在可接受範圍
4. ✅ UI 顯示正確且美觀
5. ✅ 編輯後圖片質量良好

當所有測試通過後，系統即可投入正式使用！🚀
